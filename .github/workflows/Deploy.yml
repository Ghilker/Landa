name: Deploy via FTP

on: push

jobs:
  deploy:
    name: Deploy
    runs-on: ubuntu-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v2
    - name: Create Deployment Branch
      run: git checkout -b deployment
    - name: Replace Username
      run: sed -i 's/_DATABASE_USERNAME_/${{ secrets.DATABASE_USERNAME }}/g' $GITHUB_WORKSPACE/config.inc.php
    - name: Replace Password
      run: sed -i 's/_DATABASE_PASSWORD_/${{ secrets.DATABASE_PASSWORD }}/g' $GITHUB_WORKSPACE/config.inc.php
    - name: Replace Database Name
      run: sed -i 's/_DATABASE_NAME_/${{ secrets.DATABASE_NAME }}/g' $GITHUB_WORKSPACE/config.inc.php
    - name: FTP Deploy
      uses: SamKirkland/FTP-Deploy-Action@3.1.2
      with:
        ftp-server: ${{ secrets.FTP_SERVER }}
        ftp-username: ${{ secrets.FTP_USERNAME }}
        ftp-password: ${{ secrets.FTP_PASSWORD }}
    - name: Delete Deployment Branch
      run: git branch -D deployment
